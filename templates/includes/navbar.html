{# templates/includes/navbar.html #}

<header class="bg-base-100 border-b border-base-300">
  <div class="navbar max-w-6xl mx-auto px-4">

    <!-- Brand -->
    <div class="flex-1">
      <a href="{% url 'club:home' %}" class="btn btn-ghost normal-case text-2xl font-bold text-primary">
        ğŸ… Heritage Tomato Club
      </a>
      <span class="hidden lg:block ml-2 text-xs text-base-content/70">
        UK heritage tomato seed club & seed swap
      </span>
    </div>

    <!-- Desktop nav -->
    <nav class="hidden md:flex gap-3 items-center">
      {% with request.resolver_match.url_name as url_name %}

        <!-- Seed Library -->
        <a href="{% url 'seeds:variety_list' %}"
           class="htc-nav-link {% if url_name == 'variety_list' or url_name == 'variety_detail' %}htc-nav-link--active{% endif %}">
          <span class="text-sm text-secondary">ğŸŒ±</span>
          <span>Seed Library</span>
        </a>

        <!-- Resources -->
        <a href="{% url 'club:resources' %}"
           class="htc-nav-link {% if url_name == 'resources' %}htc-nav-link--active{% endif %}">
          Resources
        </a>

        <!-- About -->
        <a href="{% url 'club:about' %}"
           class="htc-nav-link {% if url_name == 'about' %}htc-nav-link--active{% endif %}">
          About
        </a>

        <!-- Membership (active also for checkout/success/cancel) -->
        <a href="{% url 'club:membership' %}"
           class="htc-nav-link {% if url_name == 'membership' or url_name == 'membership_checkout' or url_name == 'membership_success' or url_name == 'membership_cancel' %}htc-nav-link--active{% endif %}">
          Membership
        </a>

        <!-- Contact -->
        <a href="{% url 'club:contact' %}"
           class="htc-nav-link {% if url_name == 'contact' %}htc-nav-link--active{% endif %}">
          Contact
        </a>

        {% if user.is_authenticated %}
          <!-- Grow Diary -->
          <a href="{% url 'diary:entry_list' %}"
             class="htc-nav-link {% if url_name == 'entry_list' %}htc-nav-link--active{% endif %}">
            <span class="text-sm">ğŸ““</span>
            <span>Grow diary</span>
          </a>
        {% endif %}

        {% if user.is_authenticated %}
          <!-- Avatar dropdown -->
          <div class="dropdown dropdown-end">
            <button tabindex="0"
                    type="button"
                    class="btn btn-ghost btn-circle avatar"
                    aria-label="Open account menu">
              <div class="w-9 rounded-full">
                {% if user.profile.avatar %}
                  <img
                    src="{{ user.profile.avatar.url }}"
                    alt="Profile photo"
                    class="object-cover w-full h-full"
                  >
                {% else %}
                  <div class="w-9 h-9 rounded-full bg-base-300 grid place-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-5 w-5 opacity-70"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7"
                            d="M15.75 7.5a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.5 20.25a8.25 8.25 0 1115 0v.75H4.5v-.75z" />
                    </svg>
                  </div>
                {% endif %}
              </div>
            </button>

            <ul tabindex="0"
                class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-56">
              <li class="px-2 pb-2 border-b border-base-200 mb-1">
                <p class="text-xs uppercase tracking-wide text-base-content/60">
                  Signed in as
                </p>
                <p class="font-semibold text-sm truncate">
                  {{ user.profile.display_name|default:user.username }}
                </p>
              </li>

              <li><a href="{% url 'profiles:profile-detail' %}">My profile</a></li>
              <li><a href="#" aria-disabled="true">Dashboard <span class="text-xs opacity-60">(coming soon)</span></a></li>
              <li><a href="{% url 'account_change_password' %}">Change password</a></li>
              <li><a href="{% url 'account_logout' %}">Log out</a></li>
            </ul>
          </div>

        {% else %}

          <!-- Guest: login + join free -->
          <a href="{% url 'account_login' %}" class="btn btn-ghost btn-sm">
            Log in
          </a>

          <a href="{% url 'account_signup' %}"
             class="btn btn-primary btn-sm md:btn-md rounded-full gap-2">
            <span class="text-sm">ğŸ…</span>
            <span>Join free</span>
          </a>
        {% endif %}

      {% endwith %}
    </nav>


    <!-- Mobile Menu -->
    <div class="md:hidden flex items-center gap-2">
      <div class="dropdown dropdown-end">
        <label tabindex="0"
               role="button"
               class="btn btn-ghost btn-square"
               aria-label="Open main menu">
          <svg xmlns="http://www.w3.org/2000/svg"
               class="h-6 w-6"
               fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </label>

        {% with request.resolver_match.url_name as url_name %}
          <ul tabindex="0"
              class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">

            <li><a href="{% url 'club:home' %}"
                   class="{% if url_name == 'home' %}text-accent font-semibold{% endif %}">Home</a></li>

            <li>
              <a href="{% url 'seeds:variety_list' %}"
                 class="flex items-center gap-2 {% if url_name == 'variety_list' or url_name == 'variety_detail' %}text-accent font-semibold{% endif %}">
                <span class="text-sm text-secondary">ğŸŒ±</span>
                <span>Seed Library</span>
              </a>
            </li>

            <li><a href="{% url 'club:resources' %}"
                   class="{% if url_name == 'resources' %}text-accent font-semibold{% endif %}">Resources</a></li>

            <li><a href="{% url 'club:about' %}"
                   class="{% if url_name == 'about' %}text-accent font-semibold{% endif %}">About</a></li>

            <li><a href="{% url 'club:membership' %}"
                   class="{% if url_name in 'membership membership_checkout membership_success membership_cancel' %}text-accent font-semibold{% endif %}">Membership</a></li>

            <li><a href="{% url 'club:contact' %}"
                   class="{% if url_name == 'contact' %}text-accent font-semibold{% endif %}">Contact</a></li>

            {% if user.is_authenticated %}
              <li>
                <a href="{% url 'diary:entry_list' %}"
                   class="flex items-center gap-2 {% if url_name == 'entry_list' %}text-accent font-semibold{% endif %}">
                  <span class="text-sm">ğŸ““</span>
                  <span>Grow diary</span>
                </a>
              </li>

              <li class="mt-1 border-t border-base-200 pt-1"><a href="{% url 'profiles:profile-detail' %}">My profile</a></li>
              <li><a href="#" aria-disabled="true">Dashboard (coming soon)</a></li>
              <li><a href="{% url 'account_logout' %}">Log out</a></li>

            {% else %}
              <li class="mt-1 border-t border-base-200 pt-1"><a href="{% url 'account_login' %}">Log in</a></li>
              <li>
                <a href="{% url 'account_signup' %}"
                   class="btn btn-primary btn-sm w-full justify-center gap-2 mt-1 rounded-full">
                  <span class="text-sm">ğŸ…</span>
                  <span>Join free</span>
                </a>
              </li>
            {% endif %}
          </ul>
        {% endwith %}
      </div>
    </div>

  </div>
</header>
